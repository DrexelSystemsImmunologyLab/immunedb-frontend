<script type="text/ng-template" id="mutationsModal.html">
  <div class="modal-header">
      <h4 class="modal-title">{{ title }}</h4>
  </div>
  <div class="modal-body">
    <table class="table">
      <thead>
        <tr class="active">
          <th>
            Count 
          </th>
          <th>
            Position
          </th>
          <th>
            Mutation
          </th>
        </tr>
      </thead>
      <tbody ng-repeat="type in ['synonymous', 'conservative', 'nonconservative']" ng-show="data.mutations[type].length > 0">
        <tr class="info">
          <td colspan="3"><strong>{{ type | capitalize }}</strong></td>
        </tr>
        <tr ng-repeat="mut in data.mutations[type]">
          <td>{{ mut[0] }}</td>
          <td>{{ mut[1][0] }}</td>
          <td><strong>{{ mut[1][1] }}</strong> to <strong>{{ mut[1][2] }}</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" ng-click="dismiss()">Dismiss</button>
  </div>
</script>
<div class="header">
  <ol class="breadcrumb">
    <li><a href="#/clones"><i class="fa fa-sitemap fa-fw"></i>Clones</a> </li>
    <li>Clone Comparison</li>
  </ol>
</div>

<h3>Mutation Analysis</h3>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr class="active">
        <th>Clone #</th>
        <th>V Gene</th>
        <th>J Gene</th>
        <th>CDR3 Length</th>
        <th>CDR3 AA</th>
      </tr>
    </thead>
    <tbody ng-repeat="info in cloneInfo">
      <tr>
        <td>{{ info.clone.id }}</td>
        <td>{{ info.clone.v_gene }}</td>
        <td>{{ info.clone.j_gene }}</td>
        <td>{{ info.clone.cdr3.length }}</td>
        <td ng-bind-html="info.clone.cdr3 | aminoAcid" class="text-mono"></td>
      </tr>
      <tr>
        <td colspan="5">
          <button ng-click="showSeqs = !showSeqs" class="btn btn-primary">{{ showSeqs ? 'Hide Sequences' : 'Show Sequences' }}</button>
        </td>
      </tr>
      <tr ng-show="showSeqs">
        <td colspan="5">
          <table class="table table-bordered">
            <thead>
              <tr class="info">
                <th>Sample #</th>
                <th>Sample Name</th>
                <th>Sequence ID</th>
              </tr>
            </thead>
            <tbody ng-repeat="stat in info.seqs">
              <tr>
                <td>{{ stat.sample.id }}</td>
                <td><a href="#/samples/{{ stat.sample.id }}" target="_blank">{{ stat.sample.name }}</a></td>
                <td><a href="#/sequence/{{ stat.seq_id }}" target="_blank">{{ stat.seq_id }}</a></td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="5" ng-init="field='unique'">
          <h4>
            {{ field == 'total' ? 'Total' : 'Unique' }} Mutations
          </h4>
          <table class="table table-bordered">
            <thead>
              <tr class="info">
                <th>Region</th>
                <th>Synonymous</th>
                <th>Non-Synonymous</th>
                <th>Conservative</th>
                <th>Non-Conservative</th>
              </tr>
            </thead>
            <tbody ng-repeat="(region, stat) in info.mutation_stats.regions">
              <tr>
                <td>
                  <strong>{{ region | uppercase }}</strong>
                  <button ng-disabled="stat.counts[field].synonymous + stat.counts[field].nonconservative + stat.counts[field].conservative == 0" class="btn btn-default btn-xs"
                  ng-click="openModal('Mutations', stat)">Show Mutations</button>
                </td>
                <td>{{ stat.counts[field].synonymous }} ({{ 100 * stat.counts[field].synonymous / stat.counts[field].sum | number:2}}%)</td>
                <td>{{ stat.counts[field].nonconservative + stat.counts[field].conservative }} ({{ 100 * (stat.counts[field].nonconservative +
                  stat.counts[field].conservative) / stat.counts[field].sum | number:2}}%)</td>

                <td class="active">{{ stat.counts[field].conservative }} ({{ 100 * stat.counts[field].conservative / (stat.counts[field].nonconservative +
                  stat.counts[field].conservative) | number:2}}%)</td>
                <td class="active">{{ stat.counts[field].nonconservative }} ({{ 100 * stat.counts[field].nonconservative / (stat.counts[field].nonconservative +
                  stat.counts[field].conservative) | number:2}}%)</td>
              </tr>
            </tbody>
          </table>
          <button ng-click="field = (field == 'unique' ? 'total' : 'unique')" class="btn btn-primary">Switch to {{ showTotal ? 'Unique' : 'Total' }} Mutations</button>
        </td>
      </tr>
      <tr>
        <td class="text-mono" colspan="5">
          <div class="slideWrap">
            <span class="scroller">
              <canvas id="compare-{{ info.clone.id }}">
              Your browser doesn't support HTML5! Please download a newer browser.
              </canvas>
            </span>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
